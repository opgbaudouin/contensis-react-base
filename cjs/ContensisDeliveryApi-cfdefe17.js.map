{"version":3,"file":"ContensisDeliveryApi-cfdefe17.js","sources":["../src/util/ContensisDeliveryApi.js"],"sourcesContent":["import { Client } from 'contensis-delivery-api';\nimport { parse } from 'query-string';\nimport { setSurrogateKeys } from '../routing/redux/actions';\nimport { reduxStore } from '~/redux/store/store';\n\nconst storeSurrogateKeys = response => {\n  const keys = response.headers.get\n    ? response.headers.get('surrogate-key')\n    : response.headers.map['surrogate-key'];\n  if (keys) reduxStore?.dispatch(setSurrogateKeys(keys, response.url));\n};\n\nexport const getClientConfig = project => {\n  let config = DELIVERY_API_CONFIG; /* global DELIVERY_API_CONFIG */\n  config.responseHandler = {};\n\n  if (project) {\n    config.projectId = project;\n  }\n\n  // we only want the surrogate key header in a server context\n  if (typeof window === 'undefined') {\n    config.defaultHeaders = {\n      'x-require-surrogate-key': true,\n    };\n    config.responseHandler[200] = storeSurrogateKeys;\n  }\n\n  if (\n    typeof window !== 'undefined' &&\n    PROXY_DELIVERY_API /* global PROXY_DELIVERY_API */\n  ) {\n    // ensure a relative url is used to bypass the need for CORS (separate OPTIONS calls)\n    config.rootUrl = '';\n    config.responseHandler[404] = () => null;\n  }\n  return config;\n};\n\nexport * from 'contensis-delivery-api';\n\nclass DeliveryApi {\n  getClientSideVersionStatus = () => {\n    if (typeof window !== 'undefined') {\n      // Allow overriding versionStatus with the querystring\n      const { versionStatus } = parse(window.location.search);\n      if (versionStatus) return versionStatus;\n      // Client-side we will have a global variable set if rendered by SSR in production\n      if (typeof window.versionStatus !== 'undefined')\n        return window.versionStatus;\n      // For localhost development we can only work out versionStatus from the current hostname\n      const currentHostname = window.location.hostname;\n      return this.getVersionStatusFromHostname(currentHostname);\n    }\n    return null;\n  };\n  getServerSideVersionStatus = request =>\n    request.query.versionStatus ||\n    deliveryApi.getVersionStatusFromHeaders(request.headers) ||\n    deliveryApi.getVersionStatusFromHostname(request.hostname);\n  getVersionStatusFromHeaders = headers => {\n    const versionStatusHeader = headers['x-entry-versionstatus'];\n    if (typeof versionStatusHeader !== 'undefined') return versionStatusHeader;\n    return null;\n  };\n  getVersionStatusFromHostname = currentHostname => {\n    if (currentHostname.indexOf('localhost') > -1) return 'latest';\n\n    if (currentHostname.endsWith('contensis.cloud')) {\n      if (currentHostname.indexOf('preview.') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    if (currentHostname.endsWith('cloud.contensis.com')) {\n      if (currentHostname.indexOf('preview-') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    return 'published';\n  };\n  search = (query, linkDepth, project, env) => {\n    const client = Client.create(getClientConfig(project, env));\n    return client.entries.search(\n      query,\n      typeof linkDepth !== 'undefined' ? linkDepth : 1\n    );\n  };\n  getClient = (deliveryApiStatus = 'published', project, env) => {\n    const baseConfig = getClientConfig(project, env);\n    baseConfig.versionStatus = deliveryApiStatus;\n    return Client.create(baseConfig);\n  };\n  getEntry = (\n    id,\n    linkDepth = 0,\n    deliveryApiStatus = 'published',\n    project,\n    env\n  ) => {\n    const baseConfig = getClientConfig(project, env);\n    baseConfig.versionStatus = deliveryApiStatus;\n    const client = Client.create(baseConfig);\n    // return client.entries.get(id, linkDepth);\n    return client.entries.get({ id, linkDepth });\n  };\n}\n\nexport const deliveryApi = new DeliveryApi();\n\nclass CacheNode {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.next = null;\n    this.prev = null;\n  }\n}\n\nclass LruCache {\n  constructor(limit = 100) {\n    this.map = {};\n    this.head = null;\n    this.tail = null;\n    this.limit = limit || 100;\n    this.size = 0;\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      let value = this.map[key].value;\n      let node = new CacheNode(key, value);\n      this.remove(key);\n      this.setHead(node);\n      return value;\n    }\n  }\n\n  set(key, value) {\n    let node = new CacheNode(key, value);\n    if (this.map[key]) {\n      this.remove(key);\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key];\n        this.size--;\n        this.tail = this.tail.prev;\n        this.tail.next = null;\n      }\n    }\n    this.setHead(node);\n  }\n\n  setHead(node) {\n    node.next = this.head;\n    node.prev = null;\n    if (this.head) {\n      this.head.prev = node;\n    }\n    this.head = node;\n    if (!this.tail) {\n      this.tail = node;\n    }\n    this.size++;\n    this.map[node.key] = node;\n  }\n\n  remove(key) {\n    let node = this.map[key];\n    if (!node) return; // This is sometimes null and crashes the container without this check\n\n    if (node.prev) {\n      node.prev.next = node.next;\n    } else {\n      this.head = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    } else {\n      this.tail = node.prev;\n    }\n    delete this.map[key];\n    this.size--;\n  }\n}\n\nclass CachedSearch {\n  cache = new LruCache();\n  taxonomyLookup = {};\n\n  search(query, linkDepth, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(\n      project + JSON.stringify(query) + linkDepth.toString(),\n      () => client.entries.search(query, linkDepth)\n    );\n  }\n\n  searchUsingPost(query, linkDepth = 0, project = '', env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(\n      project + JSON.stringify(query) + linkDepth.toString(),\n      () => client.entries.searchUsingPost(query, linkDepth)\n    );\n  }\n\n  get(id, linkDepth, versionStatus, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    client.clientConfig.versionStatus = versionStatus;\n    return this.request(id, () => client.entries.get({ id, linkDepth }));\n  }\n\n  getContentType(id, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(`[CONTENT TYPE] ${id} ${project}`, () =>\n      client.contentTypes.get(id)\n    );\n  }\n\n  getTaxonomyNode(key, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(`[TAXONOMY NODE] ${key}`, () =>\n      client.taxonomy\n        .resolveChildren(key)\n        .then(node => this.extendTaxonomyNode(node))\n    );\n  }\n\n  getRootNode(options, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(`${project} / ${JSON.stringify(options)}`, () =>\n      client.nodes.getRoot(options)\n    );\n  }\n\n  getNode(options, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(\n      `${project} ${(options && options.path) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.get(options)\n    );\n  }\n\n  getAncestors(options, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(\n      `${project} [A] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getAncestors(options)\n    );\n  }\n\n  getChildren(options, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(\n      `${project} [C] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getChildren(options)\n    );\n  }\n\n  getSiblings(options, project, env) {\n    const client = Client.create(getClientConfig(project, env));\n    return this.request(\n      `${project} [S] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getSiblings(options)\n    );\n  }\n\n  request(key, execute) {\n    if (!this.cache.get(key) || typeof window == 'undefined') {\n      let promise = execute();\n      this.cache.set(key, promise);\n      promise.catch(() => {\n        this.cache.remove(key);\n      });\n    }\n    return this.cache.get(key);\n  }\n}\n\nexport const cachedSearch = new CachedSearch();\n"],"names":["storeSurrogateKeys","response","keys","headers","get","map","reduxStore","dispatch","setSurrogateKeys","url","getClientConfig","project","config","DELIVERY_API_CONFIG","responseHandler","projectId","window","defaultHeaders","PROXY_DELIVERY_API","rootUrl","DeliveryApi","getClientSideVersionStatus","versionStatus","parse","location","search","currentHostname","hostname","getVersionStatusFromHostname","getServerSideVersionStatus","request","query","deliveryApi","getVersionStatusFromHeaders","versionStatusHeader","indexOf","endsWith","linkDepth","env","client","Client","create","entries","getClient","deliveryApiStatus","baseConfig","getEntry","id","CacheNode","constructor","key","value","next","prev","LruCache","limit","head","tail","size","node","remove","setHead","set","CachedSearch","cache","taxonomyLookup","JSON","stringify","toString","searchUsingPost","clientConfig","getContentType","contentTypes","getTaxonomyNode","taxonomy","resolveChildren","then","extendTaxonomyNode","getRootNode","options","nodes","getRoot","getNode","path","getAncestors","getChildren","getSiblings","execute","promise","catch","cachedSearch"],"mappings":"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"}